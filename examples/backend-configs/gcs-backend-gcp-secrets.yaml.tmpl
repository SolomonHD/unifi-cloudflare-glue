# Google Cloud Storage Backend Template for GCP Secret Manager Integration
# This template uses vals to inject secrets from GCP Secret Manager at runtime.
#
# Prerequisites:
#   1. Install vals: https://github.com/helmfile/vals
#   2. Install Google Cloud SDK: https://cloud.google.com/sdk/docs/install
#   3. Authenticate: gcloud auth application-default login
#   4. Set project: gcloud config set project PROJECT_ID
#
# Required GCP Secrets:
#   Secret: "tf-state-bucket" (contains bucket name)
#   Secret: "tf-credentials" (optional, contains service account JSON key)
#
#   Create secrets with:
#   echo -n "my-bucket-name" | gcloud secrets create tf-state-bucket --data-file=-
#
# Usage:
#   # Render the template (creates backend.yaml with actual secrets)
#   vals eval -f gcs-backend-gcp-secrets.yaml.tmpl > backend.yaml
#
#   # Deploy with rendered backend
#   dagger call deploy \
#       --backend-type=gcs \
#       --backend-config-file=./backend.yaml \
#       --kcl-source=./kcl \
#       ...
#
#   # Clean up rendered secrets immediately after use
#   rm backend.yaml
#
# vals Reference Formats:
#   - Latest version: ref+gcpsecretsmanager://secret-name
#   - Specific version: ref+gcpsecretsmanager://secret-name#versions/1
#   - With project ID: ref+gcpsecretsmanager://secret-name?project=my-project-id
#
# Security Notes:
#   - NEVER commit rendered .yaml files to version control
#   - Add *.yaml (but not *.yaml.tmpl) to .gitignore
#   - Use automated cleanup with Makefile to prevent secret leaks

# GCP Secret Manager vals references
# Format: ref+gcpsecretsmanager://<secret-name>
bucket: ref+gcpsecretsmanager://tf-state-bucket
prefix: unifi-cloudflare-glue/terraform

# Optional: Include credentials from Secret Manager
# Uncomment if storing service account key in Secret Manager
# credentials: ref+gcpsecretsmanager://tf-service-account-key

# Optional: Static values (not recommended - use vals instead)
# Uncomment below if not using vals secret injection
# bucket: "my-terraform-state-bucket"
