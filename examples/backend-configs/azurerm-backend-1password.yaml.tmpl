# Azure Blob Storage Backend Template for 1Password Integration
# This template uses vals to inject secrets from 1Password at runtime.
#
# Prerequisites:
#   1. Install vals: https://github.com/helmfile/vals
#   2. Install 1Password CLI: https://developer.1password.com/docs/cli/get-started/
#   3. Sign in: eval $(op signin)
#   4. Install Azure CLI: https://learn.microsoft.com/en-us/cli/azure/install-azure-cli
#   5. Login: az login
#
# Required 1Password Items:
#   - Vault: "Terraform State" (or your vault name)
#   - Item: "Azure Terraform Backend" (or your item name)
#   - Fields: client_id, client_secret, subscription_id, tenant_id
#
# Usage:
#   # Render the template (creates backend.yaml with actual secrets)
#   vals eval -f azurerm-backend-1password.yaml.tmpl > backend.yaml
#
#   # Deploy with rendered backend
#   dagger call deploy \
#       --backend-type=azurerm \
#       --backend-config-file=./backend.yaml \
#       --kcl-source=./kcl \
#       ...
#
#   # Clean up rendered secrets immediately after use
#   rm backend.yaml
#
# Security Notes:
#   - NEVER commit rendered .yaml files to version control
#   - Add *.yaml (but not *.yaml.tmpl) to .gitignore
#   - Use automated cleanup with Makefile to prevent secret leaks

storage_account_name: myterraformstate
container_name: terraform-state
key: unifi-cloudflare-glue/terraform.tfstate
resource_group_name: my-resource-group

# 1Password vals references
# Format: ref+op://<vault>/<item>/<field>
client_id: ref+op://Terraform State/Azure Terraform Backend/client_id
client_secret: ref+op://Terraform State/Azure Terraform Backend/client_secret
subscription_id: ref+op://Terraform State/Azure Terraform Backend/subscription_id
tenant_id: ref+op://Terraform State/Azure Terraform Backend/tenant_id

# Optional: Static credentials (not recommended - use vals instead)
# Uncomment below if not using vals secret injection
# client_id: "00000000-0000-0000-0000-000000000000"
# client_secret: "your-client-secret"
# subscription_id: "00000000-0000-0000-0000-000000000000"
# tenant_id: "00000000-0000-0000-0000-000000000000"
