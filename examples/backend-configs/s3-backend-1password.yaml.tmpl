# S3 Backend Configuration Template for 1Password Integration
# This template uses vals to inject secrets from 1Password at runtime.
#
# Prerequisites:
#   1. Install vals: https://github.com/helmfile/vals
#   2. Install 1Password CLI: https://developer.1password.com/docs/cli/get-started/
#   3. Sign in: eval $(op signin)
#
# Required 1Password Items:
#   - Vault: "Terraform State" (or your vault name)
#   - Item: "AWS Terraform Backend" (or your item name)
#   - Fields: access_key, secret_key
#
# Usage:
#   # Render the template (creates backend.yaml with actual secrets)
#   vals eval -f s3-backend-1password.yaml.tmpl > backend.yaml
#
#   # Deploy with rendered backend
#   dagger call deploy \
#       --backend-type=s3 \
#       --backend-config-file=./backend.yaml \
#       --kcl-source=./kcl \
#       ...
#
#   # Clean up rendered secrets immediately after use
#   rm backend.yaml
#
# Security Notes:
#   - NEVER commit rendered .yaml files to version control
#   - Add *.yaml (but not *.yaml.tmpl) to .gitignore
#   - Use automated cleanup with Makefile to prevent secret leaks

bucket: my-terraform-state-bucket
key: unifi-cloudflare-glue/terraform.tfstate
region: us-east-1
encrypt: true
dynamodb_table: terraform-state-lock

# 1Password vals references
# Format: ref+op://<vault>/<item>/<field>
access_key: ref+op://Terraform State/AWS Terraform Backend/access_key
secret_key: ref+op://Terraform State/AWS Terraform Backend/secret_key

# Optional: Static credentials (not recommended - use vals instead)
# Uncomment below if not using vals secret injection
# access_key: "AKIAIOSFODNN7EXAMPLE"
# secret_key: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
